/* devicemanagement_alarmList 9.16.4 2018-11-07T09:48:11+00:00 f3088a38af4a (release/9.16.0) tip */
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}angular.module("c8y.parts.alarmList",[]).config(["c8yNavigatorProvider","c8yViewsProvider","gettext",function(e,t,n){var i="bell",a="alarms",s=n("Overviews");e.addNavigation({parent:s,name:n("Alarms"),priority:2480,icon:i,path:a}),t.when("/alarms",{templateUrl:"devicemanagement_alarmList/views/index.html"}),t.when("/device/:deviceId",{name:n("Alarms"),priority:800,icon:i,templateUrl:"devicemanagement_alarmList/views/index.html"})}]);var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(){"use strict";function e(e,t,n,i,a,s,r,l,c){function o(){var e=_.reverse(_.cloneDeep(i.severityList));E.severities=_.map(e,function(e){return new D(e)}),E.unresolved=!0,C(),t.deviceId&&($.source=t.deviceId,$.pageSize=1e3),u(),E.severities.forEach(function(e){e.active=!0}),v(),d()}function u(){E.severities.forEach(function(e){e.filters=_extends({},$,{severity:e.name})})}function v(){r.changeTitle({title:c("Alarms")})}function d(){var t=S+"/*";if($.source&&(t=S+"/"+$.source),T){if(t===T)return;a.removeSubscriber(e.$id,T),O()}T=t,m(e.$id+"-subscribed",g),m("CREATE",y),m("UPDATE",y),O=e.$on("$destroy",function(){a.removeSubscriber(e.$id,T)}),E.realtime&&p()}function m(t,n){a.addListener(e.$id,T,t,n)}function f(){E.realtime!==h()&&p()}function h(){return a.getStatus(e.$id,T)}function g(){A()}function y(e,t){var n=_.find(E.severities,{name:t.severity});if(_.isString(n.count))n.reloadCount();else{var i=0;"CREATE"===e&&("ACTIVE"!==t.status&&"ACKNOWLEDGED"!==t.status||(i=n.filters.resolved?0:1),"CLEARED"===t.status&&(i=n.filters.resolved?1:0)),"UPDATE"===e&&"CLEARED"===t.status&&(i=n.filters.resolved?1:-1),n.count+=i}}function p(){a.switchRealtime(e.$id,T)}function b(){return t.deviceId?E.unresolved:void 0}function C(){$.resolved=!E.unresolved,u()}function w(){return s({title:c("Confirm clearing alarms?"),body:c("Do you really want to clear all alarms of selected severities?"),status:"danger"}).then(L).then(function(e){var t=e.resolvedImmediately;t?l.success(c("Alarms cleared.")):l.success(c("Alarms are being cleared in background."))}).then(A)}function L(){var e=_.filter(E.severities,"active"),t=_.map(e,function(e){var t=_extends({resolved:!1},_.pick(e.filters,["source","severity"])),n={status:i.status.CLEARED};return i.updateBulk(t,n)});return n.all(t).then(function(e){return{resolvedImmediately:_.every(e,function(e){return 200===e.status})}})}function A(){e.$broadcast("alarmListRefresh"),E.severities.forEach(function(e){return e.reloadCount()})}function k(){return _.some(E.severities,"refreshing")}var E=this,$={pageSize:100},x=new WeakMap,R=new WeakMap,D=function(){function e(t){_classCallCheck(this,e),this.name=t,this.active=!1,this.filters={},this.count=null,this.countLoading=!1}return _createClass(e,[{key:"toggleActive",value:function(){this.active=!this.active}},{key:"reloadCount",value:function(){var e=this;this.active&&(this.countLoading=!0,i.getDisplayCount(_.omit(this.filters,"pageSize")).then(function(t){e.count=t}).finally(function(){e.countLoading=!1}))}},{key:"active",get:function(){return x.get(this)},set:function(e){x.set(this,e),this.reloadCount()}},{key:"filters",get:function(){return R.get(this)},set:function(e){R.set(this,e),this.reloadCount()}}]),e}(),S="/alarmsWithChildren",T=void 0,O=void 0;_.assign(E,{icon:i.icon,realtime:!0,onVmUnresolvedChange:C,clientSideUnresolved:b,resolveAll:w,refresh:A,isRefreshing:k}),o(),e.$watch("vm.realtime",f)}e.$inject=["$scope","$routeParams","$q","c8yAlarms","c8yRealtime","c8yModal","c8yTitle","c8yAlert","gettext"],angular.module("c8y.parts.alarmList").controller("alarmListCtrl",e)}(),function(){"use strict";function e(e){var t;t='<div ng-controller="alarmListCtrl as vm">\n  <c8y-ui-action-bar-set>\n    <li class="btn-group" action-bar-position="left">\n      <button ng-repeat="severity in vm.severities" type="button" class="btn btn-default" ng-model="severity.active" ng-click="severity.toggleActive()" ng-class="{\'active\': severity.active}">\n        <i c8y-icon="{{vm.icon(severity.name)}}" class="status" ng-class="severity.name | lowercase"></i>\n        <span ng-bind="severity.name | lowercase | humanize | translate"></span>\n        <span ng-if="severity.active" class="badge badge-dark">\n          <span ng-if="severity.countLoading"><i c8y-icon="circle-o-notch" class="fa-spin"></i></span>\n          <span ng-if="!severity.countLoading" ng-bind="severity.count"></span>\n        </span>\n      </button>\n      <!-- @TODO: this is placeholder button to show all alarm types\n      <button type="button" class="btn btn-default">\n        {{\'All\' | translate}}\n      </button>\n      -->\n    </li>\n\n    <li class="navbar-form">\n      <label class="c8y-switch">\n        <input type="checkbox" ng-model="vm.unresolved" ng-change="vm.onVmUnresolvedChange()" ng-true-value="false" ng-false-value="true">\n        <span></span>\n        <span translate>Show cleared alarms</span>\n      </label>\n    </li>\n\n    <li>\n      <button type="button" class="btn btn-link" ng-click="vm.resolveAll()">\n        <i c8y-icon="check-circle"></i> {{\'Clear all\' | translate}}\n      </button>\n    </li>\n\n    <c8y-realtime-switch state="vm.realtime"></c8y-realtime-switch>\n\n    <a href="" class="btn btn-link" title="{{\'Refresh alarm list contents\' | translate}}" ng-click="vm.refresh()">\n      <i c8y-icon="refresh" ng-class="{\'fa-spin\': vm.isRefreshing()}"></i>\n      <span translate>Reload</span>\n    </a>\n  </c8y-ui-action-bar-set>\n\n  <div ng-repeat="severity in vm.severities">\n    <c8y-alarm-list ng-if="severity.active" filter="severity.filters" realtime="vm.realtime" hide-header-actions="true" data-title="{text:(severity.name | humanize), icon:vm.icon(severity.name), class:(severity.name | lowercase)}" unresolved="vm.clientSideUnresolved()" refresh-loading="severity.refreshing">\n    </c8y-alarm-list>\n  </div>\n</div>\n',e.put("alarmList/views/index.html",t),e.put("devicemanagement_alarmList/views/index.html",t),e.put("/apps/devicemanagement/alarmList/views/index.html",t)}angular.module("c8y.parts.alarmList").run(["$templateCache",e])}();