/* core_tenantStatistics 9.16.4 2018-11-07T09:49:03+00:00 f3088a38af4a (release/9.16.0) tip */
!function(){"use strict";function e(e,t,n){e.addNavigation({parent:n("Tenants"),name:n("Usage statistics"),path:"tenantStatistics",icon:"c8y-usage-statistics",showIf:["c8yUserUtil",function(e){"ngInject";return e.showTenantManagement()}]}),t.when("/tenantStatistics",{template:"<c8y-tenant-statistics />"})}e.$inject=["c8yNavigatorProvider","c8yViewsProvider","gettext"],angular.module("c8y.tenantStatistics",[]).config(e)}();var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};!function(){"use strict";function e(e,t,n,r,i,o,a,u,s,l,c,m,d,g,C){function p(){var e=_.get(w.statistics,"length"),t=C.getPlural(e,"1 tenant","{{$count}} tenants",{});return _.isNumber(e)?t:""}function f(){w.refreshLoading=!0,v().then(y).then(h).then(P).then(x).then(U).then(V).then(function(){w.refreshLoading=!1})}function v(){return u.isCurrentUserTopTenant().then(function(e){w.isTopTenant=e})}function y(){w.storageLimitFeatureEnabled=o.appOption("storageLimitationFeatureEnabled")}function h(){w.dateFrom=l.stringToDate(n.dateFrom)||N,w.dateTo=l.stringToDate(n.dateTo)}function P(){return a.list(S()).then(b)}function S(){return{dateFrom:l.dateToString(w.dateFrom),dateTo:l.dateToString(w.dateTo)}}function b(e){w.statistics=T(e)}function T(e){return _.map(e,function(e){return _extends({},e,{storageQuota:B(k(e)),storageSize:B(e.storageSize),peakStorageSize:B(e.peakStorageSize)})})}function B(e){return!_.isUndefined(e)&&Number((e/Math.pow(2,20)).toFixed(2))}function k(e){var t=e.storageLimitPerDevice,n=e.deviceWithChildrenCount,r=t;return r&&(r*=n||1),r}function x(){var e="c8ySchema!!customProperties";return L.list().then(function(t){return _.filter(t,{id:e})}).then(function(e){return L.getSchema(e)}).then(function(e){return _.get(e,"properties.customProperties.properties",{})}).then(function(e){return _.map(e,function(e,t){return{title:e.title,key:t,schema:e}})}).then(function(e){w.customProperties=_.sortBy(e,"title")})}function U(){w.columns=D(),w.columnsConfig={}}function D(){return _([m.getTenantIdColumn(),m.getTenantNameUrlColumn(),M(),m.getApiRequestsColumn(),m.getDeviceApiRequestsColumn(),w.storageLimitFeatureEnabled?m.getStorageQuotaColumn():null,m.getStorageSizeColumn(),m.getPeakStorageSizeColumn(),m.getRootDevicesColumn(),m.getPeakRootDevicesColumn(),m.getDevicesColumn(),m.getPeakDevicesColumn(),m.getDeviceEndpointCountColumn(),m.getSubscribedApplicationsColumn(),m.getCreationTimeColumn(),m.getAlarmsCreatedCountColumn(),m.getAlarmsUpdatedCountColumn(),m.getInventoriesCreatedCountColumn(),m.getInventoriesUpdatedCountColumn(),m.getEventsCreatedCountColumn(),m.getEventsUpdatedCountColumn(),m.getMeasurementsCreatedCountColumn(),m.getTotalInboundTransferColumn(),w.isTopTenant?m.getParentTenantIdColumn():null]).flattenDeep().compact().orderBy([function(e){return e.priority||0}],["desc"]).value()}function M(){return _.map(w.customProperties,function(e){return m.getCustomPropertyColumn(e)})}function I(e){V(e)}function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.columnsConfig;w.columnsConfig=e,w.filteredSortedStatistics=d.filterSort(w.statistics,w.columns,w.columnsConfig)}function A(){return _(w.columns).map(function(e){return _.result(e,"getCsvHeaders")||_.get(e,"header.text")||_.get(e,"header")}).flatten().value()}function q(){return _.map(w.filteredSortedStatistics,function(e){return _(w.columns).map(function(t){return t.getCsvValues(e)}).flatten().value()})}function E(e){r.path("/tenants/"+e.tenantId)}function F(){_.isEqual(S().dateFrom,N)&&_.isUndefined(S().dateTo)||r.search(S())}function R(){r.search({})}function z(){f()}var w=this,L=c.another(c.paths.Tenants),N=l.stringToDate(o.fromThisMonthStartFilter().dateFrom),W=g("No tenants to display.");_.assign(w,{noItemsMessage:W,getSubtitle:p,$onInit:f,onColumnsConfigChanged:I,getCsvHeaders:A,getCsvData:q,detail:E,filter:F,clearFilter:R,refresh:z})}e.$inject=["$scope","$q","$routeParams","$location","$filter","c8yBase","c8yStatistics","c8yTenant","c8yTitle","c8yUtil","c8yPropertiesLibrary","c8yTenantStatisticsColumns","c8yFilteringSortingCollections","gettext","gettextCatalog"],angular.module("c8y.tenantStatistics").component("c8yTenantStatistics",{templateUrl:"core_tenantStatistics/tenant-statistics.html",controller:e,controllerAs:"vm"})}(),function(){"use strict";function e(e,t,n){function r(){return e.getColumn({name:"alarmsCreated",header:n("Alarms created"),cell:{template:"{{item.alarmsCreatedCount}}"},filteringByPattern:{itemProperty:"alarmsCreatedCount"},sortingByPath:{itemProperty:"alarmsCreatedCount"},getCsvValues:function(e){return[e.alarmsCreatedCount]}})}function i(){return e.getColumn({name:"alarmsUpdated",header:n("Alarms updated"),cell:{template:"{{item.alarmsUpdatedCount}}"},filteringByPattern:{itemProperty:"alarmsUpdatedCount"},sortingByPath:{itemProperty:"alarmsUpdatedCount"},getCsvValues:function(e){return[e.alarmsUpdatedCount]}})}function o(){return e.getColumn({name:"inventoriesCreated",header:n("Inventories created"),cell:{template:"{{item.inventoriesCreatedCount}}"},filteringByPattern:{itemProperty:"inventoriesCreatedCount"},sortingByPath:{itemProperty:"inventoriesCreatedCount"},getCsvValues:function(e){return[e.inventoriesCreatedCount]}})}function a(){return e.getColumn({name:"inventoriesUpdated",header:n("Inventories updated"),cell:{template:"{{item.inventoriesUpdatedCount}}"},filteringByPattern:{itemProperty:"inventoriesUpdatedCount"},sortingByPath:{itemProperty:"inventoriesUpdatedCount"},getCsvValues:function(e){return[e.inventoriesUpdatedCount]}})}function u(){return e.getColumn({name:"eventsCreated",header:n("Events created"),cell:{template:"{{item.eventsCreatedCount}}"},filteringByPattern:{itemProperty:"eventsCreatedCount"},sortingByPath:{itemProperty:"eventsCreatedCount"},getCsvValues:function(e){return[e.eventsCreatedCount]}})}function s(){return e.getColumn({name:"eventsUpdated",header:n("Events updated"),cell:{template:"{{item.eventsUpdatedCount}}"},filteringByPattern:{itemProperty:"eventsUpdatedCount"},sortingByPath:{itemProperty:"eventsUpdatedCount"},getCsvValues:function(e){return[e.eventsUpdatedCount]}})}function l(){return e.getColumn({name:"measurementsCreated",header:n("Measurements created"),cell:{template:"{{item.measurementsCreatedCount}}"},filteringByPattern:{itemProperty:"measurementsCreatedCount"},sortingByPath:{itemProperty:"measurementsCreatedCount"},getCsvValues:function(e){return[e.measurementsCreatedCount]}})}function c(){return e.getColumn({name:"totalInboundTransfer",header:n("Total inbound transfer"),cell:{template:"{{item.totalResourceCreateAndUpdateCount}}"},filteringByPattern:{itemProperty:"totalResourceCreateAndUpdateCount"},sortingByPath:{itemProperty:"totalResourceCreateAndUpdateCount"},getCsvValues:function(e){return[e.totalResourceCreateAndUpdateCount]}})}function m(){return e.getColumn({name:"tenantId",header:n("Id"),cell:{template:"{{item.tenantId}}"},filteringByPattern:{itemProperty:"tenantId"},sortingByPath:{itemProperty:"tenantId"},getCsvValues:function(e){return[e.tenantId]}})}function d(){var t=function(e){return"https://"+e.tenantDomain};return e.getColumn({name:"tenantNameUrl",header:n("Name"),cell:{template:'<a ng-href="{{getTenantUrl(item)}}">{{item.tenantCompany}}</a>',scopeExtensions:{getTenantUrl:t}},filteringByPattern:{itemProperty:"tenantCompany"},sortingByPath:{itemProperty:"tenantCompany"},getCsvHeaders:function(){return[n("Name"),n("URL")]},getCsvValues:function(e){return[e.tenantCompany,t(e)]}})}function g(t){var n=t.key,r=["tenantCustomProperties",n],i={name:n,priority:_.startsWith(n,"limit.")?-1e3:0,header:t.title,cell:{template:"<div\n            ng-bind-html=\"getValue(item, '"+n+"') |\n              formatBySchema:getSchema(tenantCustomProperties, '"+n+"')\">\n          </div>",scopeExtensions:{getValue:function(e,t){return _.get(e,["tenantCustomProperties",t])},getSchema:function(e,t){return _.get(e,[t,"schema"])}}},getCsvHeaders:function(){return["externalReference"===n?t.title:n]},getCsvValues:function(e){return[p(e,t)]}};return _.merge(i,C(t)),_.set(i.cell.scopeExtensions,r,t),e.getColumn(i)}function C(e){var n=t.getType(e),r=n.filteringKey,i="sortingByPath",o=["tenantCustomProperties",e.key],a={itemProperty:o},u={};return _.set(u,r,a),_.set(u,i,a),u}function p(e,t){var n=_.get(t,"schema.default");return _.get(e,["tenantCustomProperties",t.key],n)}function f(){return e.getColumn({name:"requestCount",header:n("API requests"),cell:{template:"{{item.requestCount}}"},filteringByMinMax:{itemProperty:"requestCount"},sortingByPath:{itemProperty:"requestCount"},getCsvValues:function(e){return[e.requestCount]}})}function v(){return e.getColumn({name:"deviceRequestCount",header:n("Device API requests"),cell:{template:"{{item.deviceRequestCount}}"},filteringByMinMax:{itemProperty:"deviceRequestCount"},sortingByPath:{itemProperty:"deviceRequestCount"},getCsvValues:function(e){return[e.deviceRequestCount]}})}function y(){return e.getColumn({name:"storageQuota",header:n("Storage quota (MB)"),cell:{template:'<span ng-if="item.storageLimitPerDevice">{{item.storageQuota}}</span>'},filteringByMinMax:{itemProperty:"storageQuota"},sortingByPath:{itemProperty:"storageQuota"},getCsvValues:function(e){return[e.storageQuota||""]}})}function h(){return e.getColumn({name:"storageSize",header:n("Storage (MB)"),cell:{template:"{{item.storageSize}}"},filteringByMinMax:{itemProperty:"storageSize"},getCsvValues:function(e){return[e.storageSize]}})}function P(){return e.getColumn({name:"peakStorageSize",header:n("Peak storage (MB)"),cell:{template:"{{item.peakStorageSize}}"},filteringByMinMax:{itemProperty:"peakStorageSize"},getCsvValues:function(e){return[e.peakStorageSize]}})}function S(){return e.getColumn({name:"deviceCount",header:{text:n("Root devices"),tooltip:{icon:"question-circle-o",text:n("Number of root devices, excluding child devices")}},cell:{template:"{{item.deviceCount}}"},filteringByMinMax:{itemProperty:"deviceCount"},sortingByPath:{itemProperty:"deviceCount"},getCsvValues:function(e){return[e.deviceCount]}})}function b(){return e.getColumn({name:"peakDeviceCount",header:{text:n("Peak root devices"),tooltip:{icon:"question-circle-o",text:n("Peak number of root devices, excluding child devices")}},cell:{template:"{{item.peakDeviceCount}}"},filteringByMinMax:{itemProperty:"peakDeviceCount"},sortingByPath:{itemProperty:"peakDeviceCount"},getCsvValues:function(e){return[e.peakDeviceCount]}})}function T(){return e.getColumn({name:"deviceWithChildrenCount",header:{text:n("Devices"),tooltip:{icon:"question-circle-o",text:n("Number of devices, including child devices")}},cell:{template:"{{item.deviceWithChildrenCount}}"},filteringByMinMax:{itemProperty:"deviceWithChildrenCount"},sortingByPath:{itemProperty:"deviceWithChildrenCount"},getCsvValues:function(e){return[e.deviceWithChildrenCount]}})}function B(){return e.getColumn({name:"peakDeviceWithChildrenCount",header:{text:n("Peak devices"),tooltip:{icon:"question-circle-o",text:n("Peak number of devices, including child devices")}},cell:{template:"{{item.peakDeviceWithChildrenCount}}"},filteringByMinMax:{itemProperty:"peakDeviceWithChildrenCount"},sortingByPath:{itemProperty:"peakDeviceWithChildrenCount"},getCsvValues:function(e){return[e.peakDeviceWithChildrenCount]}})}function k(){return e.getColumn({name:"subscribedApplications",header:n("Subscribed applications"),cell:{template:"{{(item.subscribedApplications || []).length}}"},filteringByMinMax:{itemProperty:"subscribedApplications.length"},sortingByPath:{itemProperty:"subscribedApplications.length"},getCsvValues:function(e){return[_.join(e.subscribedApplications," ")]}})}function x(){return e.getColumn({name:"creationTime",header:n("Creation time"),cell:{template:"{{item.creationTime | absoluteDate}}"},filteringByMinMaxDate:{itemProperty:"creationTime"},sortingByPath:{itemProperty:"creationTime"},getCsvValues:function(e){return[e.creationTime&&moment(e.creationTime).format("L")]}})}function U(){return e.getColumn({name:"parentTenantId",header:n("Parent tenant"),cell:{template:"{{item.parentTenantId}}"},filteringByPattern:{itemProperty:"parentTenantId"},sortingByPath:{itemProperty:"parentTenantId"},getCsvValues:function(e){return[e.parentTenantId]}})}function D(){return e.getColumn({name:"deviceEndpointCount",header:{text:n("Endpoint devices"),tooltip:{icon:"question-circle-o",text:n("Leaf machines (without gateways and edges)")}},cell:{template:"{{item.deviceEndpointCount}}"},filteringByPattern:{itemProperty:"deviceEndpointCount"},sortingByPath:{itemProperty:"deviceEndpointCount"},getCsvValues:function(e){return[e.deviceEndpointCount]}})}return{getTenantIdColumn:m,getTenantNameUrlColumn:d,getCustomPropertyColumn:g,getApiRequestsColumn:f,getDeviceApiRequestsColumn:v,getStorageQuotaColumn:y,getStorageSizeColumn:h,getPeakStorageSizeColumn:P,getRootDevicesColumn:S,getPeakRootDevicesColumn:b,getDevicesColumn:T,getPeakDevicesColumn:B,getSubscribedApplicationsColumn:k,getCreationTimeColumn:x,getParentTenantIdColumn:U,getDeviceEndpointCountColumn:D,getAlarmsCreatedCountColumn:r,getAlarmsUpdatedCountColumn:i,getInventoriesCreatedCountColumn:o,getInventoriesUpdatedCountColumn:a,getEventsCreatedCountColumn:u,getEventsUpdatedCountColumn:s,getMeasurementsCreatedCountColumn:l,getTotalInboundTransferColumn:c}}e.$inject=["c8yFilteringSortingCollections","SchemaPropertiesSvc","gettext"],angular.module("c8y.tenantStatistics").factory("c8yTenantStatisticsColumns",e)}(),function(){"use strict";function e(e){var t;t='<c8y-ui-title-set title="\'Usage statistics\' | translate" subtitle="vm.getSubtitle()">\r\n</c8y-ui-title-set>\r\n\r\n<c8y-ui-action-bar-set>\r\n  <li class="navbar-form" action-bar-position="left">\r\n    <form class="form-inline">\r\n      <div class="form-group datepicker">\r\n        <input class="form-control" style="width: 120px; text-align: center" ng-model="vm.dateFrom" uib-datepicker-popup datepicker-options="{maxDate: vm.dateTo}" is-open="openFrom" ng-click="openFrom=true" placeholder="{{\'Date from\' | translate}}">\r\n      </div>\r\n      <div class="form-group datepicker">\r\n        <input class="form-control" style="width: 120px; text-align: center" ng-model="vm.dateTo" uib-datepicker-popup datepicker-options="{minDate: vm.dateFrom}" is-open="openTo" ng-click="openTo=true" placeholder="{{\'Date to\' | translate}}">\r\n      </div>\r\n      <button name="apply" type="submit" class="btn btn-link" style="display: inline-block; width: auto" ng-click="vm.filter()" title="{{\'Apply filters\' | translate}}">\r\n        <i c8y-icon="filter"></i>\r\n        {{\'Filter\' | translate}}\r\n      </button>\r\n      <button ng-if="vm.dateFrom || vm.dateTo" name="clear" type="button" class="btn btn-link" style="display: inline-block; width: auto" ng-click="vm.clearFilter()" title="{{\'Clear filters\' | translate}}">\r\n        <i c8y-icon="times"></i>\r\n      </button>\r\n    </form>\r\n  </li>\r\n\r\n  <a href="" class="btn btn-link" c8y-csv-exporter c8y-headers="vm.getCsvHeaders()" c8y-data="vm.getCsvData()">\r\n  <i c8y-icon="table"></i>\r\n    {{\'Export CSV\' | translate}}\r\n  </a>\r\n\r\n  <button type="button" class="btn btn-link" ng-click="vm.refresh()">\r\n    <i c8y-icon="refresh" ng-class="{\'fa-spin\': vm.refreshLoading}"></i>\r\n    {{\'Reload\' | translate}}\r\n  </button>\r\n</c8y-ui-action-bar-set>\r\n\r\n<div>\r\n  <c8y-filtered-sorted-list columns="vm.columns" columns-config="vm.columnsConfig" on-columns-config-changed="vm.onColumnsConfigChanged(columnsConfig)" items="vm.filteredSortedStatistics" no-items-message="vm.noItemsMessage" on-item-click="vm.detail(item)">\r\n  </c8y-filtered-sorted-list>\r\n</div>\r\n',e.put("tenantStatistics/tenant-statistics.html",t),e.put("core_tenantStatistics/tenant-statistics.html",t),e.put("/apps/core/tenantStatistics/tenant-statistics.html",t)}angular.module("c8y.tenantStatistics").run(["$templateCache",e])}();