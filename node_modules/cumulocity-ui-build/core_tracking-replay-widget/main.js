/* core_tracking-replay-widget 9.16.4 2018-11-07T09:49:05+00:00 f3088a38af4a (release/9.16.0) tip */
function _asyncToGenerator(n){return function(){var t=n.apply(this,arguments);return new Promise(function(n,e){function a(r,i){try{var c=t[r](i),o=c.value}catch(n){return void e(n)}return c.done?void n(o):Promise.resolve(o).then(function(n){a("next",n)},function(n){a("throw",n)})}return a("next")})}}function _toConsumableArray(n){if(Array.isArray(n)){for(var t=0,e=Array(n.length);t<n.length;t++)e[t]=n[t];return e}return Array.from(n)}function _asyncToGenerator(n){return function(){var t=n.apply(this,arguments);return new Promise(function(n,e){function a(r,i){try{var c=t[r](i),o=c.value}catch(n){return void e(n)}return c.done?void n(o):Promise.resolve(o).then(function(n){a("next",n)},function(n){a("throw",n)})}return a("next")})}}!function(){"use strict";angular.module("c8y.pocs.trackingReplayWidget",[])}(),function(){"use strict";angular.module("c8y.pocs.trackingReplayWidget").constant("trackingReplayConstants",{TRACKING_EVENT_FRAGMENT_TYPE:"c8y_Position",DUESSELDORF:{lat:51.2277,lng:6.7735},OSM_TILE_URL:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",DEFAULT_ANIMATION_STEP_DELAY:1e3})}(),function(){"use strict";function n(n,t){n.add({name:"trackingReplay",nameDisplay:t("Tracking replay"),description:t("Displays track lines of tracking device with replay feature"),widgetComponent:"c8yTrackingReplayWidget",options:{noDeviceTarget:!1,deviceTargetNotRequired:!1,groupsSelectable:!1}})}n.$inject=["c8yComponentsProvider","gettext"],angular.module("c8y.pocs.trackingReplayWidget").config(n)}();var _extends=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a])}return n};!function(){"use strict";function n(n,t){function e(n){var t=L.tileLayer(d,{noWrap:!0});return L.map(n,{center:u,zoom:13,layers:[t]})}function a(){return L.marker(u)}function r(){return L.polyline([])}function i(n){var t=n.map,e=n.layers,a=n.points,r=n.step;if(c(t,e),!_.isEmpty(a)){var i=e.marker,o=e.path,s=_.nth(a,r),l=s.lng,u=s.lat;i.setLatLng({lng:l,lat:u}),i.bindPopup("lng: "+l+", lat: "+u),t.addLayer(i),o.setLatLngs(_.take(a,r+1)),t.addLayer(o),t.fitBounds(a)}}function c(n,t){_.forEach(t,n.removeLayer.bind(n))}function o(n){return _.map(n,"c8y_Position")}var s=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.list(_extends({},e,{fragmentType:l,revert:!0}));case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}(),l=t.TRACKING_EVENT_FRAGMENT_TYPE,u=t.DUESSELDORF,d=t.OSM_TILE_URL,p={createMap:e,createDeviceMarker:a,createTrackingPath:r,renderPathSnapshot:i,getTrackingEventsFor:s,getPointsFor:o};return p}n.$inject=["c8yEvents","trackingReplayConstants"],angular.module("c8y.pocs.trackingReplayWidget").factory("trackingReplayService",n)}();var _extends=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a])}return n};!function(){"use strict";function n(n,t,e,a,r){function i(){L=r.createMap(n.find(".tracking-map")[0]),P={marker:r.createDeviceMarker(),path:r.createTrackingPath()}}function c(n){var t=n.config;t&&o(w.config)}function o(n){var t=_.get(n,"device.id");t&&(w.filter=_extends({},w.filter,{source:t}))}function s(){_.isEqual(R,w.filter)||(R=_.cloneDeep(w.filter),x())}function l(){w.paused=!1,w.playing=!0,D||(D=t(p,F))}function u(){t.cancel(D),F*=2,D=t(p,F)}function d(){t.cancel(D),F/=2,D=t(p,F)}function p(){w.playing&&(w.step<A.length-1?(w.step+=1,b()):f())}function g(n){k(),w.step=n,b()}function v(){t.cancel(D)}function m(n){w.trackingEvents=[].concat(_toConsumableArray(w.trackingEvents),_toConsumableArray(n)),e.paging=n.paging,A=r.getPointsFor(w.trackingEvents),f(),e.$apply()}function f(n){y(),w.step=n?0:A.length-1,b(),w.step=n?0:-1}function y(){t.cancel(D),D=void 0,F=E,w.step=-1,k()}function k(){w.playing=!1,w.paused=!0}function b(){r.renderPathSnapshot({map:L,layers:P,points:A,step:w.step})}var h=function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(){var t,e,a,i,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=R,e=t.source,a=t.dateFrom,i=t.dateTo,!(e&&a&&i)){n.next=7;break}return w.trackingEvents=[],n.next=5,r.getTrackingEventsFor(R);case 5:c=n.sent,m(c);case 7:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}(),T=function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.paging.loading=!0,n.next=3,e.paging.next();case 3:t=n.sent,m(t);case 5:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}(),E=a.DEFAULT_ANIMATION_STEP_DELAY,w=this,x=_.debounce(h,250),R=void 0,L=void 0,P=void 0,A=void 0,F=void 0,D=void 0;_.assign(w,{$onInit:i,$onChanges:c,$doCheck:s,$onDestroy:v,slower:u,faster:d,play:l,pause:k,reset:f,stepTo:g,step:-1,paused:!0,playing:!1,interval:"days",filter:{dateFrom:moment().subtract(1,"day").format(),dateTo:moment().format()}}),e.paging={},e.loadNext=T}n.$inject=["$element","$interval","$scope","trackingReplayConstants","trackingReplayService"],angular.module("c8y.pocs.trackingReplayWidget").component("c8yTrackingReplayWidget",{templateUrl:"core_tracking-replay-widget/widget.html",bindings:{config:"<"},controllerAs:"vm",controller:n})}(),function(){"use strict";function n(n){var t;t='<div class="widget-gps-tracking">\n  <div class="navbar navbar-default">\n    <ul class="nav navbar-nav navbar-left">\n      <li class="navbar-form form-group-sm">\n        <c8y-date-time-picker style="display: inline-block" class="bottom-m-xs" placeholder="{{\'From`date`\' | translate}}" ng-model="vm.filter.dateFrom" max-date="vm.filter.dateTo">\n        </c8y-date-time-picker>\n        <c8y-date-time-picker style="display: inline-block" class="bottom-m-xs" placeholder="{{\'To`date`\' | translate}}" ng-model="vm.filter.dateTo" min-date="vm.filter.dateFrom">\n        </c8y-date-time-picker>\n      </li>\n      <li class="navbar-form form-group-sm">\n        <c8y-interval date-from="vm.filter.dateFrom" date-to="vm.filter.dateTo" interval="vm.interval">\n        </c8y-interval>\n      </li>\n    </ul>\n\n    <ul class="nav navbar-nav navbar-right">\n      <li class="navbar-form">\n        <div class="btn-group">\n          <button class="btn btn-default btn-sm" title="{{\'Slower\' | translate}}" ng-click="vm.slower()">\n            <i c8y-icon="fast-backward"></i>\n          </button>\n          <button class="btn btn-default btn-sm" title="{{\'Play\' | translate}}" ng-if="vm.paused" ng-click="vm.play()">\n            <i c8y-icon="play"></i>\n          </button>\n          <button class="btn btn-default btn-sm" title="{{\'Pause\' | translate}}" ng-if="vm.playing" ng-click="vm.pause()">\n            <i c8y-icon="pause"></i>\n          </button>\n\n          <button class="btn btn-default btn-sm" title="{{\'Faster\' | translate}}" ng-click="vm.faster()">\n            <i c8y-icon="fast-forward"></i>\n          </button>\n          <button class="btn btn-default btn-sm" title="{{\'Reset\' | translate}}" ng-click="vm.reset()">\n            <i c8y-icon="repeat"></i>\n          </button>\n        </div>\n      </li>\n    </ul>\n  </div>\n  <!-- /.navbar-default -->\n  <div class="widget-gps-tracking-content">\n    <div class="col-sm-6 col-md-8 col-xs-12 flex-item-v-stretch widget-gps-tracking-map">\n      <div class="tracking-map"></div>\n    </div>\n    <div class="col-sm-6 col-md-4 col-xs-12 event-list flex-item-v-stretch">\n      <h4 class="card-title bottom-m-xs" translate>Tracking events</h4>\n      <div ng-if="vm.trackingEvents.length === 0">\n        <hr style="margin:0">\n        <div class="c8y-empty-state text-left">\n          <h1 class="c8y-icon c8y-icon-location c8y-icon-duocolor"></h1>\n          <p translate>No tracking events found</p>\n        </div>\n      </div>\n\n      <div class="card-inner-scroll" ng-show="vm.trackingEvents.length > 0">\n        <div class="list-group">\n          <div class="list-group-item flex-row" ng-repeat="event in vm.trackingEvents " ng-click="vm.stepTo($index) " ng-class="{ \'list-group-item-info\': $index===vm.step} ">\n            <div class="list-item-icon">\n              <i c8y-icon="c8y-location "></i>\n            </div>\n            <div class="list-item-body">\n              {{event.time | date:\'medium\'}}\n            </div>\n          </div>\n        </div>\n        <c8y-load-more></c8y-load-more>\n      </div>\n\n    </div>\n  </div>\n</div>',n.put("tracking-replay-widget/widget.html",t),n.put("core_tracking-replay-widget/widget.html",t),n.put("/apps/core/tracking-replay-widget/widget.html",t)}angular.module("c8y.pocs.trackingReplayWidget").run(["$templateCache",n])}();